var F=Object.defineProperty;var C=(l,u,c)=>u in l?F(l,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[u]=c;var r=(l,u,c)=>(C(l,typeof u!="symbol"?u+"":u,c),c);(function(l,u){typeof exports=="object"&&typeof module!="undefined"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(l=typeof globalThis!="undefined"?globalThis:l||self,u(l["wrapper-lib"]={}))})(this,function(l){"use strict";class u{constructor(e){r(this,"obsVal");r(this,"boundFrom");this.obsVal=e,this.boundFrom=[]}getVal(e){if(e==null)return this.obsVal;let s=e.split("."),t=this.obsVal;for(;s.length>1;){let i=s.shift();t=t[i]}return t[s[0]]}setVal(e,s){if(s){let t=s.split("."),i=this.obsVal;for(;t.length>1;){let n=t.shift();i=i[n]}i[t[0]]=e}else this.obsVal=e;return this.notifySubscribers(e,s),this.obsVal}notifySubscribers(e,s){this.boundFrom.forEach(t=>{t.to==this&&t.handleChange(e,s)})}}class c{constructor(e){r(this,"boundVal");r(this,"boundTo");this.boundVal=e,this.boundTo=[]}bindTo(e,s,t){let i=new v(this,e,s,t);return e.boundFrom.push(i),this.boundTo.push(i),this}getBindings(){return this.boundTo}breakBinding(e,s){return this.boundTo.forEach(t=>{t.to==e&&t.changeKey==s&&t.break()}),this}}class v{constructor(e,s,t,i){r(this,"from");r(this,"to");r(this,"changeKey");r(this,"xferFunc");this.from=e,this.to=s,this.changeKey=t,i?this.xferFunc=i:t?this.xferFunc=()=>{let n=t.split("."),h=this.to.getVal();typeof h=="object"&&n.forEach(a=>{h.hasOwnProperty(a)?h=h[a]:console.warn(`
                                Attempting to traverse bound path '${t}' 
                                failed at '${a}'`)}),this.from.boundVal=h}:this.xferFunc=()=>{this.from.boundVal=this.to.getVal()}}handleChange(e,s){if(s==this.changeKey){let t=this.xferFunc(e,s);t!=null&&t!=null&&(this.from.constructor.name=="Wrapper"?this.from.text(t):this.from.boundVal=t)}}break(){this.from.boundTo=this.from.boundTo.filter(e=>e!=this),this.to.boundFrom=this.to.boundFrom.filter(e=>e!=this)}}class m extends u{constructor(e,s,t){super("");r(this,"element");r(this,"parent");r(this,"children");r(this,"boundFrom");r(this,"boundTo");r(this,"boundVal");if(this.boundFrom=[],this.boundTo=[],this.children=[],s?this.element=s:this.element=document.createElement(e),this.element.tagName==="INPUT"&&this.onEvent("input",()=>{this.notifySubscribers.bind(this)(this.getVal(),"value")}),this.element.tagName==="SELECT"&&this.onEvent("change",()=>{this.notifySubscribers.bind(this)(this.getVal(),"value")}),this.element.tagName==="TEXTAREA"&&this.onEvent("input",()=>{this.notifySubscribers.bind(this)(this.getVal(),"value")}),t){if(t.i&&(this.element.id=t.i),t.n&&this.element.setAttribute("name",t.n),t.v)if(this.element.hasOwnProperty("value"))this.element.value=t.v;else throw new Error("attempted to set value on a tag that doesn't support that");t.t!=null&&(this.element.innerText=t.t),t.h!=null&&(this.element.innerHTML=t.h),t.c!=null&&this.class(t.c),t.s&&this.element.setAttribute("style",t.s),t.iT&&this.element.setAttribute("type",t.iT),t.b&&this.bindTo(t.b,void 0,i=>{this.text(i)})}}notifySubscribers(e,s){this.boundFrom.forEach(t=>{t.to==this&&t.handleChange(e,s)})}bindTo(e,s,t){t||(t=n=>{this.text(n)}),!s&&e.constructor.name=="Wrapper"&&(s="value");let i=new v(this,e,s,t);return e.boundFrom.push(i),this.boundTo.push(i),this}bindTextTo(e,s,t){return this.text(JSON.stringify(e.getVal())),typeof e.getVal()=="string"&&this.text(e.getVal()),e.constructor.name=="Wrapper"&&s=="text"&&this.text(e.getText()),e.constructor.name=="Wrapper"&&s=="style"&&this.text(e.getStyle()),this.bindTo(e,s,t)}bindStyleTo(e,s,t){return t||(t=i=>{this.style(i)}),this.bindTo(e,s,t)}bindValueTo(e,s,t){return t||(t=i=>{this.setVal(i)}),this.bindTo(e,s,t)}bindListTo(e,s){this.bindTo(e,s,t=>{this.html(""),this.listContent(t)}).listContent(e.getVal())}bindSelectTo(e,s){this.bindTo(e,s,t=>{this.html(""),this.selectContent(t)}).selectContent(e.getVal())}getBindings(){return this.boundTo}breakBinding(e,s){return this.boundTo.forEach(t=>{t.to==e&&t.changeKey==s&&t.break()}),this}static wrap(e,s){return new m(e.tagName,e,s)}newWrap(e,s,t="inside"){let i=new m(e,void 0,s);return t==="inside"&&(this.element.appendChild(i.element),this.children.push(i),i.parent=this),t==="after"&&this.element.after(i.element),t==="before"&&this.element.before(i.element),i}text(e){return this.element.innerText=e,this.notifySubscribers(e,"text"),this}attr(e,s){return this.element.setAttribute(e,s),this}html(e){return this.element.innerHTML=e,this}style(e,s){let t="";return s&&this.element.getAttribute("style")!=null&&(t=this.element.getAttribute("style").trim(),t.charAt(t.length-1)!=";"&&(t=t+"; ")),this.element.setAttribute("style",t+e),this.notifySubscribers(this.getStyle(),"style"),this}class(e){return typeof e=="string"&&(e=[e]),this.element.classList.add(e.join(" ")),this}name(e){return this.element.setAttribute("name",e),this}placehold(e){return this.element.setAttribute("placeholder",e),this}inputType(e){return this.element.setAttribute("type",e),this}kill(){this.element.remove()}killChildren(){this.children.forEach(e=>{e.kill()})}removeClass(e){return this.element.classList.remove(e),this}relocate(e,s="inside"){return s==="inside"&&e.element.appendChild(this.element),s==="before"&&e.element.before(this.element),s==="after"&&e.element.after(this.element),this}getAttr(e){return this.element.getAttribute(e)}setAttr(e,s){return this.attr(e,s)}getStyle(){let e=this.element.getAttribute("style");return e==null&&(e=""),e}setStyle(e){return this.style(e)}getText(){return this.element.innerText}setText(e){return this.text(e)}getVal(){return this.element.tagName=="INPUT"&&this.getAttr("type")=="checkbox"?this.element.checked:this.element.value}setVal(e){return this.element.value=e,this.notifySubscribers(e,"value"),this}getData(e){return this.element.dataset[e]}setData(e,s){return this.element.setAttribute("data-"+e,s),this}addChild(e){return e.relocate(this,"inside"),this.children.push(e),e.parent=this,e}addBefore(e){return e.relocate(this,"before")}addAfter(e){return e.relocate(this,"after")}addMultiWrap(e,s="0.5em",t){return new E(e,this.element,s,t)}onEvent(e,s){return this.element.addEventListener(e,t=>s(t)),this}onClick(e){return this.onEvent("click",e),this}onInput(e){return this.onEvent("input",e),this}onChange(e){return this.onEvent("change",e),this}onEnterKey(e){return this.element.addEventListener("keyup",function(s){s.code==="Enter"&&(s.preventDefault(),e(s))}),this}disable(e=!0){try{this.element.disabled=!0}catch{e&&console.warn("Cannot disabled a "+this.element.tagName+" element.")}return this}enable(e=!0){try{this.element.disabled=!1}catch{e&&console.warn("Cannot enable a "+this.element.tagName+" element.")}return this}display(e){return this.element.style.display=e,this}listContent(e,s){if(this.element.tagName!="UL"&&this.element.tagName!="OL")throw console.error(`The Wrapper instance from which listContent was called is not 
            wrapped around a 'ul' or 'ol' element. It's a ${this.element}`),new Error('List Content must be appended to a "ul" or "ol"');if(this.killChildren(),s){if(e.length!=s.length)throw console.error({"not the same length":e,as:s}),new Error("textList and idList not the same length");e.forEach((t,i)=>{this.newWrap("li",{i:s[i]}).text(t)})}else e.forEach(t=>{this.newWrap("li").text(t)});return this}selectContent(e,s,t){if(s||(s=e),e.length!=s.length)throw console.error({"not the same length":e,as:s}),new Error("textList and idList not the same length");if(t){if(e.length!=t.length)throw console.error({"not the same length":e,as:t}),new Error("textList and idList not the same length");e.forEach((i,n)=>{this.newWrap("option",{i:t[n]}).text(i).setVal(s[n])})}else e.forEach((i,n)=>{this.newWrap("option").text(i).setVal(s[n])});return this}makeInputFor(e,s,t,i="inside"){let n=this.newWrap("div",void 0,i).style("display: flex;"),h=new y(e,s,t,n.element);return n.addChild(h.label),n.addChild(h.input),h}makeFormFor(e,s,t,i){let n=new p(e,s,t,i);return n.form.relocate(this,"inside"),n}}class w{constructor(e,s,t){r(this,"label");r(this,"input");r(this,"observer");if(typeof e!="object")throw new Error("Primatives cannot be used to create LabeledInput instances.");Object.keys(e).length>1&&console.warn("More than one key was passed into makeInputFor. Other keys were ignored");const i=Object.keys(e)[0],n=e[i],h=s||i;let a=Math.random().toString(36).slice(7);this.label=new m("label").attr("for",a).text(h);let o="text";typeof n=="number"&&(o="number"),typeof n=="boolean"&&(o="checkbox"),typeof n=="string"&&n.length>99&&(o="textarea"),Array.isArray(n)?T(n)?o="select":console.warn("An array of Objects is not supported by LabeledInput"):typeof n=="object"&&(Object.prototype.toString.call(n)==="[object Date]"?o="date":console.warn("Create a DynamicForm instance instead of a LabeledInput. (i.e. New DyanmicForm or wrapper.makeFormFor(...)"));let d="input";t!=null&&(t?o="textarea":o="text"),o==="textarea"||o==="select"?(this.input=new m(o,void 0,{i:a}),o==="select"&&this.input.selectContent(n)):this.input=new m(d,void 0,{i:a,iT:o}),this.observer=new c,this.observer.bindTo(this.input,"value"),o=="date"?this.input.setVal(n.toISOString().substr(0,10)):o==="checkbox"?(this.observer.boundVal=n,n===!0&&this.input.setAttr("checked","")):this.input.setVal(n)}getValue(){return this.observer.boundVal}}class y extends m{constructor(e,s,t,i){super("div",i);r(this,"container");r(this,"label");r(this,"input");r(this,"observer");this.container=this.element,this.style("display:flex; gap: 0.5em;");let n=new w(e,s,t);this.label=n.label,this.input=n.input,this.observer=n.observer}}class p{constructor(e,s,t,i,n){r(this,"form");r(this,"parentBreadcrumb");r(this,"gridStyle");r(this,"lblStyle");r(this,"inputStyle");r(this,"lines");r(this,"values");if(typeof e!="object")throw new Error("Primatives cannot be used to create DynamicForm instances.");let h=Object.keys(e);this.lines=[[]],this.inputStyle=i,this.gridStyle=s,this.lblStyle=t,this.values={},this.parentBreadcrumb=n,h.forEach(o=>{let d=e[o];if(g(d)||V(d)||T(d)){let b=new w({[o]:e[o]});t&&b.label.style(t),i&&b.input.style(i),this.values[o]=b.observer,this.lines.push([b.label,b.input])}else if(Array.isArray(d))this.lines.push([new m("h4",void 0,{s:"margin-bottom: 0.25em",t:o})]),d.forEach((b,S)=>{let A=new p(b,s,t,i,S.toString());this.values[o]==null&&(this.values[o]=[]),this.values[o].push(A),this.lines.push([A.form,"merge"])});else{let b=new p(d,s,t,i,o);this.values[o]=b,this.lines.push([b.form,"merge"])}});let a="form";n&&(a="fieldset"),this.form=new m(a).addMultiWrap(this.lines),n&&this.form.newWrap("legend").text(n.toString()),s&&this.form.style(this.form.getStyle()+"; "+s)}getFormData(){let e={};return Object.keys(this.values).forEach(s=>{if(this.values[s].constructor.name=="DynamicForm")e[s]=this.values[s].getFormData();else if(Array.isArray(this.values[s])){let t=[];this.values[s].forEach(i=>{t.push(i.getFormData())}),e[s]=t}else e[s]=this.values[s].boundVal}),e}addFormSection(e,s){let t=new p(e,this.gridStyle,this.lblStyle,this.inputStyle,s);return this.form.addRow([t.form,"merge"]),this.values[s]=t,this}addInputToForm(e,s,t){let i=Object.keys(e)[0];Object.keys(this.getFormData()).some(h=>h===i)&&console.warn("duplicate key detected: "+i);let n=new y(e,s,t);return this.values[i]=n.observer,this.form.addRow([n.label,n.input]),this}}class E extends m{constructor(e,s,t="0.5em",i="div"){super(i,s);r(this,"rows");r(this,"cols");this.style("display: grid; gap:"+t),this.rows=e.length,this.cols=0,e.forEach(n=>{n.length>this.cols&&(this.cols=n.length)}),e.forEach((n,h)=>{n.forEach((a,o)=>{if(a!="merge"){let d=o+1;for(;n[d]=="merge";)d++;a.style(`
                            ${a.getStyle()};
                            grid-row: ${h+1};
                            grid-column: ${o+1} / ${d+1}
                        `),a.relocate(this,"inside"),this.children.push(a)}})})}addRow(e){return e.forEach((s,t)=>{if(s!="merge"){let i=t+1;for(;e[i]=="merge";)i++;s.style(`
                        ${s.getStyle()};
                        grid-row: ${this.rows+1};
                        grid-column: ${t+1} / ${i+1}
                    `),s.relocate(this,"inside")}}),this.rows=this.rows+1,this}}const g=f=>!(typeof f=="object"||typeof f=="function"),V=f=>g(f)?!1:Object.prototype.toString.call(f)==="[object Date]",T=f=>!(!Array.isArray(f)||f.some(e=>!g(e)));l.Binding=v,l.DynamicForm=p,l.LabeledInput=w,l.Observable=u,l.Observer=c,l.WrapGrid=E,l.WrappedInputLabelPair=y,l.Wrapper=m,l.isArrayOfPrimatives=T,l.isDate=V,l.isPrimative=g,Object.defineProperty(l,"__esModule",{value:!0}),l[Symbol.toStringTag]="Module"});
