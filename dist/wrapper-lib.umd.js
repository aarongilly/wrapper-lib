var F=Object.defineProperty;var C=(h,u,c)=>u in h?F(h,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):h[u]=c;var r=(h,u,c)=>(C(h,typeof u!="symbol"?u+"":u,c),c);(function(h,u){typeof exports=="object"&&typeof module!="undefined"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(h=typeof globalThis!="undefined"?globalThis:h||self,u(h["wrapper-lib"]={}))})(this,function(h){"use strict";class u{constructor(t){r(this,"obsVal");r(this,"boundFrom");this.obsVal=t,this.boundFrom=[]}getVal(t){if(t==null)return this.obsVal;let s=t.split("."),e=this.obsVal;for(;s.length>1;){let i=s.shift();e=e[i]}return e[s[0]]}setVal(t,s){if(s){let e=s.split("."),i=this.obsVal;for(;e.length>1;){let n=e.shift();i=i[n]}i[e[0]]=t}else this.obsVal=t;return this.notifySubscribers(t,s),this.obsVal}notifySubscribers(t,s){this.boundFrom.forEach(e=>{e.to==this&&e.handleChange(t,s)})}}class c{constructor(t){r(this,"boundVal");r(this,"boundTo");this.boundVal=t,this.boundTo=[]}bindTo(t,s,e){let i=new v(this,t,s,e);return t.boundFrom.push(i),this.boundTo.push(i),this}getBindings(){return this.boundTo}breakBinding(t,s){return this.boundTo.forEach(e=>{e.to==t&&e.changeKey==s&&e.break()}),this}}class v{constructor(t,s,e,i){r(this,"from");r(this,"to");r(this,"changeKey");r(this,"xferFunc");this.from=t,this.to=s,this.changeKey=e,i?this.xferFunc=i:e?this.xferFunc=()=>{let n=e.split("."),l=this.to.getVal();typeof l=="object"&&n.forEach(a=>{l.hasOwnProperty(a)?l=l[a]:console.warn(`
                                Attempting to traverse bound path '${e}' 
                                failed at '${a}'`)}),this.from.boundVal=l}:this.xferFunc=()=>{this.from.boundVal=this.to.getVal()}}handleChange(t,s){if(s==this.changeKey){let e=this.xferFunc(t,s);e!=null&&e!=null&&(this.from.constructor.name=="Wrapper"?this.from.text(e):this.from.boundVal=e)}}break(){this.from.boundTo=this.from.boundTo.filter(t=>t!=this),this.to.boundFrom=this.to.boundFrom.filter(t=>t!=this)}}class m extends u{constructor(t,s,e){super("");r(this,"element");r(this,"parent");r(this,"children");r(this,"boundFrom");r(this,"boundTo");r(this,"boundVal");if(this.boundFrom=[],this.boundTo=[],this.children=[],s?this.element=s:this.element=document.createElement(t),this.element.tagName==="INPUT"&&this.onEvent("input",()=>{this.notifySubscribers.bind(this)(this.getVal(),"value")}),this.element.tagName==="SELECT"&&this.onEvent("change",()=>{this.notifySubscribers.bind(this)(this.getVal(),"value")}),this.element.tagName==="TEXTAREA"&&this.onEvent("input",()=>{this.notifySubscribers.bind(this)(this.getVal(),"value")}),e){if(e.i&&(this.element.id=e.i),e.n&&this.element.setAttribute("name",e.n),e.v)if(this.element.hasOwnProperty("value"))this.element.value=e.v;else throw new Error("attempted to set value on a tag that doesn't support that");e.t!=null&&(this.element.innerText=e.t),e.h!=null&&(this.element.innerHTML=e.h),e.c!=null&&this.class(e.c),e.s&&this.element.setAttribute("style",e.s),e.iT&&this.element.setAttribute("type",e.iT),e.b&&this.bindTo(e.b,void 0,i=>{this.text(i)})}}notifySubscribers(t,s){this.boundFrom.forEach(e=>{e.to==this&&e.handleChange(t,s)})}bindTo(t,s,e){e||(e=n=>{this.text(n)}),!s&&t.constructor.name=="Wrapper"&&(s="value");let i=new v(this,t,s,e);return t.boundFrom.push(i),this.boundTo.push(i),this}bindTextTo(t,s,e){return this.text(JSON.stringify(t.getVal())),typeof t.getVal()=="string"&&this.text(t.getVal()),t.constructor.name=="Wrapper"&&s=="text"&&this.text(t.getText()),t.constructor.name=="Wrapper"&&s=="style"&&this.text(t.getStyle()),this.bindTo(t,s,e)}bindStyleTo(t,s,e){return e||(e=i=>{this.style(i)}),this.bindTo(t,s,e)}bindValueTo(t,s,e){return e||(e=i=>{this.setVal(i)}),this.bindTo(t,s,e)}bindListTo(t,s){this.bindTo(t,s,e=>{this.html(""),this.listContent(e)}).listContent(t.getVal())}bindSelectTo(t,s){this.bindTo(t,s,e=>{this.html(""),this.selectContent(e)}).selectContent(t.getVal())}getBindings(){return this.boundTo}breakBinding(t,s){return this.boundTo.forEach(e=>{e.to==t&&e.changeKey==s&&e.break()}),this}static wrap(t,s){return new m(t.tagName,t,s)}newWrap(t,s,e="inside"){let i=new m(t,void 0,s);return e==="inside"&&(this.element.appendChild(i.element),this.children.push(i),i.parent=this),e==="after"&&this.element.after(i.element),e==="before"&&this.element.before(i.element),i}text(t){return this.element.innerText=t,this.notifySubscribers(t,"text"),this}attr(t,s){return this.element.setAttribute(t,s),this}html(t){return this.element.innerHTML=t,this}style(t,s){let e="";return s&&this.element.getAttribute("style")!=null&&(e=this.element.getAttribute("style").trim(),e.charAt(e.length-1)!=";"&&(e=e+"; ")),this.element.setAttribute("style",e+t),this.notifySubscribers(this.getStyle(),"style"),this}class(t){return typeof t=="string"&&(t=[t]),this.element.classList.add(t.join(" ")),this}name(t){return this.element.setAttribute("name",t),this}placehold(t){return this.element.setAttribute("placeholder",t),this}inputType(t){return this.element.setAttribute("type",t),this}kill(){this.element.remove()}killChildren(){this.children.forEach(t=>{t.kill()})}removeClass(t){return this.element.classList.remove(t),this}relocate(t,s){return s==="inside"&&t.element.appendChild(this.element),s==="before"&&t.element.before(this.element),s==="after"&&t.element.after(this.element),this}getAttr(t){return this.element.getAttribute(t)}setAttr(t,s){return this.attr(t,s)}getStyle(){let t=this.element.getAttribute("style");return t==null&&(t=""),t}setStyle(t){return this.style(t)}getText(){return this.element.innerText}setText(t){return this.text(t)}getVal(){return this.element.tagName=="INPUT"&&this.getAttr("type")=="checkbox"?this.element.checked:this.element.value}setVal(t){return this.element.value=t,this.notifySubscribers(t,"value"),this}getData(t){return this.element.dataset[t]}setData(t,s){return this.element.setAttribute("data-"+t,s),this}addChild(t){return t.relocate(this,"inside"),this.children.push(t),t.parent=this,t}addBefore(t){return t.relocate(this,"before")}addAfter(t){return t.relocate(this,"after")}addMultiWrap(t,s="0.5em",e){return new E(t,this.element,s,e)}onEvent(t,s){return this.element.addEventListener(t,e=>s(e)),this}onClick(t){return this.onEvent("click",t),this}onInput(t){return this.onEvent("input",t),this}onChange(t){return this.onEvent("change",t),this}onEnterKey(t){return this.element.addEventListener("keyup",function(s){s.code==="Enter"&&(s.preventDefault(),t(s))}),this}listContent(t,s){if(this.element.tagName!="UL"&&this.element.tagName!="OL")throw console.error(`The Wrapper instance from which listContent was called is not 
            wrapped around a 'ul' or 'ol' element. It's a ${this.element}`),new Error('List Content must be appended to a "ul" or "ol"');if(this.killChildren(),s){if(t.length!=s.length)throw console.error({"not the same length":t,as:s}),new Error("textList and idList not the same length");t.forEach((e,i)=>{this.newWrap("li",{i:s[i]}).text(e)})}else t.forEach(e=>{this.newWrap("li").text(e)});return this}selectContent(t,s,e){if(s||(s=t),t.length!=s.length)throw console.error({"not the same length":t,as:s}),new Error("textList and idList not the same length");if(e){if(t.length!=e.length)throw console.error({"not the same length":t,as:e}),new Error("textList and idList not the same length");t.forEach((i,n)=>{this.newWrap("option",{i:e[n]}).text(i).setVal(s[n])})}else t.forEach((i,n)=>{this.newWrap("option").text(i).setVal(s[n])});return this}makeInputFor(t,s,e,i="inside"){let n=this.newWrap("div",void 0,i).style("display: flex;"),l=new y(t,s,e,n.element);return n.addChild(l.label),n.addChild(l.input),l}makeFormFor(t,s,e,i){let n=new p(t,s,e,i);return n.form.relocate(this,"inside"),n}}class w{constructor(t,s,e){r(this,"label");r(this,"input");r(this,"observer");if(typeof t!="object")throw new Error("Primatives cannot be used to create LabeledInput instances.");Object.keys(t).length>1&&console.warn("More than one key was passed into makeInputFor. Other keys were ignored");const i=Object.keys(t)[0],n=t[i],l=s||i;let a=Math.random().toString(36).slice(7);this.label=new m("label").attr("for",a).text(l);let o="text";typeof n=="number"&&(o="number"),typeof n=="boolean"&&(o="checkbox"),typeof n=="string"&&n.length>99&&(o="textarea"),Array.isArray(n)?T(n)?o="select":console.warn("An array of Objects is not supported by LabeledInput"):typeof n=="object"&&(Object.prototype.toString.call(n)==="[object Date]"?o="date":console.warn("Create a DynamicForm instance instead of a LabeledInput. (i.e. New DyanmicForm or wrapper.makeFormFor(...)"));let d="input";e!=null&&(e?o="textarea":o="text"),o==="textarea"||o==="select"?(this.input=new m(o,void 0,{i:a}),o==="select"&&this.input.selectContent(n)):this.input=new m(d,void 0,{i:a,iT:o}),this.observer=new c,this.observer.bindTo(this.input,"value"),o=="date"?this.input.setVal(n.toISOString().substr(0,10)):o==="checkbox"?(this.observer.boundVal=n,n===!0&&this.input.setAttr("checked","")):this.input.setVal(n)}}class y extends m{constructor(t,s,e,i){super("div",i);r(this,"container");r(this,"label");r(this,"input");r(this,"observer");this.container=this.element,this.style("display:flex; gap: 0.5em;");let n=new w(t,s,e);this.label=n.label,this.input=n.input,this.observer=n.observer}}class p{constructor(t,s,e,i,n){r(this,"form");r(this,"parentBreadcrumb");r(this,"gridStyle");r(this,"lblStyle");r(this,"inputStyle");r(this,"lines");r(this,"values");if(typeof t!="object")throw new Error("Primatives cannot be used to create DynamicForm instances.");let l=Object.keys(t);this.lines=[[]],this.inputStyle=i,this.gridStyle=s,this.lblStyle=e,this.values={},this.parentBreadcrumb=n,l.forEach(o=>{let d=t[o];if(g(d)||V(d)||T(d)){let b=new w({[o]:t[o]});e&&b.label.style(e),i&&b.input.style(i),this.values[o]=b.observer,this.lines.push([b.label,b.input])}else if(Array.isArray(d))this.lines.push([new m("h4",void 0,{s:"margin-bottom: 0.25em",t:o})]),d.forEach((b,S)=>{let A=new p(b,s,e,i,S);this.values[o]==null&&(this.values[o]=[]),this.values[o].push(A),this.lines.push([A.form,"merge"])});else{let b=new p(d,s,e,i,o);this.values[o]=b,this.lines.push([b.form,"merge"])}});let a="form";n&&(a="fieldset"),this.form=new m(a).addMultiWrap(this.lines),n&&this.form.newWrap("legend").text(n.toString()),s&&this.form.style(this.form.getStyle()+"; "+s)}getFormData(){let t={};return Object.keys(this.values).forEach(s=>{if(this.values[s].constructor.name=="DynamicForm")t[s]=this.values[s].getFormData();else if(Array.isArray(this.values[s])){let e=[];this.values[s].forEach(i=>{e.push(i.getFormData())}),t[s]=e}else t[s]=this.values[s].boundVal}),t}addFormSection(t,s){let e=new p(t,this.gridStyle,this.lblStyle,this.inputStyle,s);return this.form.addRow([e.form,"merge"]),this.values[s]=e,this}addInputToForm(t,s,e){let i=Object.keys(t)[0];Object.keys(this.getFormData()).some(l=>l===i)&&console.warn("duplicate key detected: "+i);let n=new y(t,s,e);return this.values[i]=n.observer,this.form.addRow([n.label,n.input]),this}}class E extends m{constructor(t,s,e="0.5em",i="div"){super(i,s);r(this,"rows");r(this,"cols");this.style("display: grid; gap:"+e),this.rows=t.length,this.cols=0,t.forEach(n=>{n.length>this.cols&&(this.cols=n.length)}),t.forEach((n,l)=>{n.forEach((a,o)=>{if(a!="merge"){let d=o+1;for(;n[d]=="merge";)d++;a.style(`
                            ${a.getStyle()};
                            grid-row: ${l+1};
                            grid-column: ${o+1} / ${d+1}
                        `),a.relocate(this,"inside")}})})}addRow(t){return t.forEach((s,e)=>{if(s!="merge"){let i=e+1;for(;t[i]=="merge";)i++;s.style(`
                        ${s.getStyle()};
                        grid-row: ${this.rows+1};
                        grid-column: ${e+1} / ${i+1}
                    `),s.relocate(this,"inside")}}),this.rows=this.rows+1,this}}const g=f=>!(typeof f=="object"||typeof f=="function"),V=f=>g(f)?!1:Object.prototype.toString.call(f)==="[object Date]",T=f=>!(!Array.isArray(f)||f.some(t=>!g(t)));h.Binding=v,h.DynamicForm=p,h.LabeledInput=w,h.Observable=u,h.Observer=c,h.WrapGrid=E,h.WrappedInputLabelPair=y,h.Wrapper=m,h.isArrayOfPrimatives=T,h.isDate=V,h.isPrimative=g,Object.defineProperty(h,"__esModule",{value:!0}),h[Symbol.toStringTag]="Module"});
